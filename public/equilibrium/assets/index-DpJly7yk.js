(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const S=[{id:"will",label:"PLANNING",emoji:"ğŸ¯",color:"#e07040",action:"Set intention Â· Define the target"},{id:"emanation",label:"BUILDING",emoji:"ğŸ”¨",color:"#5090c0",action:"Build Â· Create Â· Execute"},{id:"digestion",label:"COMMUNICATING",emoji:"ğŸ“¡",color:"#60a060",action:"Share Â· Polish Â· Ship"},{id:"enrichment",label:"INTEGRATING",emoji:"ğŸŒ€",color:"#a080c0",action:"Integrate Â· Reflect Â· Rest"}];function R(e){const t=Math.min(Math.floor(e*4),3);return S[t]}const v=4,H=16,U=4,D=v+H+U,ce=4,x=D*ce,be=[{name:"Sunday",planet:"Sun",symbol:"â˜‰",emoji:"â˜€ï¸",energy:"Illumination & Celebration",intelligence:"Spiritual (SQ)",description:"Vision, purpose, creative self-expression. Celebrate what you've built."},{name:"Monday",planet:"Moon",symbol:"â˜½",emoji:"ğŸŒ™",energy:"Intuition & Emotional Depth",intelligence:"Emotional (EQ)",description:"Reflection, inner sensing, emotional recalibration. Plan from feeling, not force."},{name:"Tuesday",planet:"Mars",symbol:"â™‚",emoji:"ğŸ”¥",energy:"Action & Courage",intelligence:"Kinesthetic (Body)",description:"Decisive action, physical energy, tackling hard things. Move your body."},{name:"Wednesday",planet:"Mercury",symbol:"â˜¿",emoji:"ğŸ—£ï¸",energy:"Clarity & Communication",intelligence:"Verbal-Linguistic",description:"Meetings, writing, learning, networking. Mental agility at peak."},{name:"Thursday",planet:"Jupiter",symbol:"â™ƒ",emoji:"âœ¨",energy:"Expansion & Wisdom",intelligence:"Vision-Logic",description:"Big-picture thinking, teaching, strategic planning. Expand horizons."},{name:"Friday",planet:"Venus",symbol:"â™€",emoji:"ğŸŒ¹",energy:"Beauty & Harmony",intelligence:"Aesthetic & Interpersonal",description:"Creativity, relationships, design, pleasure. Make things beautiful."},{name:"Saturday",planet:"Saturn",symbol:"â™„",emoji:"ğŸª",energy:"Structure & Grounding",intelligence:"Moral & Logical",description:"Discipline, organizing, completing. Review the week, ground the gains."}],Se=["Saturn","Jupiter","Mars","Sun","Venus","Mercury","Moon"],Ee=[3,6,2,5,1,4,0],we={Sun:{emoji:"â˜€ï¸",energy:"Vitality & Purpose"},Moon:{emoji:"ğŸŒ™",energy:"Intuition & Feeling"},Mars:{emoji:"ğŸ”¥",energy:"Drive & Action"},Mercury:{emoji:"ğŸ—£ï¸",energy:"Thought & Communication"},Jupiter:{emoji:"âœ¨",energy:"Expansion & Vision"},Venus:{emoji:"ğŸŒ¹",energy:"Beauty & Connection"},Saturn:{emoji:"ğŸª",energy:"Structure & Discipline"}},se=[{name:"New Moon",symbol:"ğŸŒ‘",start:0,end:1.85,energy:"ğŸŒ Materialization Â· Results appearing"},{name:"Waxing Crescent",symbol:"ğŸŒ’",start:1.85,end:5.53,energy:"ğŸŒ Growth spurt Â· Assist, polish, land it"},{name:"First Quarter",symbol:"ğŸŒ“",start:5.53,end:9.22,energy:"ğŸŒ¬ï¸ Harvest begins Â· Receive what's growing"},{name:"Waxing Gibbous",symbol:"ğŸŒ”",start:9.22,end:12.91,energy:"ğŸŒ¬ï¸ Abundance arriving Â· Winds of change"},{name:"Full Moon",symbol:"ğŸŒ•",start:12.91,end:16.61,energy:"ğŸ”¥ Harvest peak Â· Rejoice Â· New intention forming"},{name:"Waning Gibbous",symbol:"ğŸŒ–",start:16.61,end:20.3,energy:"ğŸ”¥ Inner fire ignites Â· Let the seed will itself"},{name:"Last Quarter",symbol:"ğŸŒ—",start:20.3,end:23.99,energy:"ğŸ’§ Creative flow Â· Let it flow freely"},{name:"Waning Crescent",symbol:"ğŸŒ˜",start:23.99,end:29.53,energy:"ğŸ’§ Deepest creation Â· No visibility, no interference"}];function ve(e){return e===1?S[0]:e===2?S[1]:e===3?S[2]:S[3]}function Ie(e,t=11){const n=e/1e3%t/t;return{position:n,inhaling:n<.5}}function Pe(e,t){if(!e)return{elapsed:0,remaining:x,progress:0,pulse:{pulseNumber:1,phase:"entry",phaseElapsed:0,phaseRemaining:v,pulseElapsed:0,pulseProgress:0},active:!1,holonicPhase:S[0]};const s=(t-e)/6e4;if(s>=x)return{elapsed:x,remaining:0,progress:1,pulse:{pulseNumber:4,phase:"exit",phaseElapsed:U,phaseRemaining:0,pulseElapsed:D,pulseProgress:1},active:!1,holonicPhase:S[3]};const o=Math.min(Math.floor(s/D),ce-1),i=s-o*D,a=s/x;let c,l,d;return i<v?(c="entry",l=i,d=v-i):i<v+H?(c="focus",l=i-v,d=H-l):(c="exit",l=i-v-H,d=U-l),{elapsed:s,remaining:x-s,progress:a,pulse:{pulseNumber:o+1,phase:c,phaseElapsed:l,phaseRemaining:d,pulseElapsed:i,pulseProgress:i/D},active:!0,holonicPhase:S[o]}}function ke(e){const t=new Date(e),n=t.getHours(),s=t.getMinutes(),o=n*60+s,i=o/1440;let a;n<6?a="dawn":n<12?a="morning":n<18?a="afternoon":a="evening";const c=Math.max(0,o-540),l=Math.floor(c/111)+1;return{hour:n,minute:s,progress:i,quarter:a,sprintSlot:l,holonicPhase:R(i)}}function Le(e,t){const s=(Ee[e]+t)%7,o=Se[s],i=we[o];return{planet:o,emoji:i.emoji,energy:i.energy,hourIndex:t}}function Te(e){const t=new Date(e),n=t.getDay(),s=t.getHours(),o=t.getMinutes(),a=((n===0?6:n-1)*1440+s*60+o)/(7*1440);return{dayOfWeek:n,progress:a,planetaryDay:be[n],planetaryHour:Le(n,s),holonicPhase:ve(n)}}function Me(e){const t=new Date(e),n=t.getMonth()+1,s=t.getDate(),o=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),i=(s-1+(t.getHours()*60+t.getMinutes())/1440)/o;return{month:n,day:s,progress:i,holonicPhase:R(i)}}function Ae(e){const t=new Date(2e3,0,6,18,14).getTime(),n=29.53058770576,i=(e-t)/864e5/n%1*n,a=i/n;let c=se[0];for(const u of se)if(i>=u.start&&i<u.end){c=u;break}const l=12.91/n,d=(a+(1-l))%1;return{phase:c.name,symbol:c.symbol,progress:a,day:i,energy:c.energy,holonicPhase:R(d)}}function Ce(e,t){const n=new Date(e),s=new Date(n.getFullYear(),0,1).getTime(),o=new Date(n.getFullYear()+1,0,1).getTime(),i=(e-s)/(o-s);let a=i;if(t){const[c,l]=t.split("-").map(Number),d=new Date(n.getFullYear(),c-1,l).getTime();if(e>=d){const u=new Date(n.getFullYear()+1,c-1,l).getTime();a=(e-d)/(u-d)}else{const u=new Date(n.getFullYear()-1,c-1,l).getTime();a=(e-u)/(d-u)}}return{progress:i,holonicPhase:R(i),personalProgress:a,personalHolonicPhase:R(a)}}function ne(e){const t={will:0,emanation:0,digestion:0,enrichment:0},n=[e.day.holonicPhase,e.week.holonicPhase,e.month.holonicPhase,e.moon.holonicPhase,e.year.holonicPhase];e.sprint.active&&n.push(e.sprint.holonicPhase);for(const l of n)t[l.id]++;let s=0,o="will";for(const[l,d]of Object.entries(t))d>s&&(s=d,o=l);const i=S.find(l=>l.id===o),a=Math.round(s/n.length*100),c=a>66?"strong":a>40?"moderate":"mixed";return{dominant:i,coherence:a,coherenceLevel:c,phaseMap:{day:e.day.holonicPhase,week:e.week.holonicPhase,month:e.month.holonicPhase,moon:e.moon.holonicPhase,year:e.year.holonicPhase,sprint:e.sprint.active?e.sprint.holonicPhase:void 0}}}function xe(e,t,n=11,s){return{breath:Ie(e,n),sprint:Pe(t,e),day:ke(e),week:Te(e),month:Me(e),moon:Ae(e),year:Ce(e,s)}}function Be(e){const t=Math.floor(e),n=Math.floor((e-t)*60);return`${t}:${n.toString().padStart(2,"0")}`}const De=["PLANNING","BUILDING","COMMUNICATING","INTEGRATING"];function Ne(e){return De[Math.min(e-1,3)]||"INCEPTION"}const Re="http://www.w3.org/2000/svg",w=200;function T(e,t){const n=document.createElementNS(Re,e);for(const[s,o]of Object.entries(t))n.setAttribute(s,o);return n}function $e(e,t,n,s,o){const i=o-s;if(i<=0)return"";const a=i>180?1:0,c=(s-90)*Math.PI/180,l=(o-90)*Math.PI/180,d=e+n*Math.cos(c),u=t+n*Math.sin(c),m=e+n*Math.cos(l),y=t+n*Math.sin(l);return`M ${d} ${u} A ${n} ${n} 0 ${a} 1 ${m} ${y}`}const _e=[.25,.5,.75,1],B=4,Oe=[{id:"sprint",radius:80,strokeWidth:16,label:"96-Min",color:"#e07040",gap:B},{id:"day",radius:100,strokeWidth:16,label:"Day",color:"#c9a84c",gap:B},{id:"week",radius:120,strokeWidth:14,label:"Week",color:"#4080c0",gap:B},{id:"month",radius:138,strokeWidth:12,label:"Moon",color:"#a080c0",gap:B},{id:"year",radius:156,strokeWidth:12,label:"Year",color:"#c06080",gap:B}];class He{svg;rings;phaseLabel;timeRemaining;transitionPrompt;dayPosition;statusBar;guidanceEl;lastPromptPhase="";promptTimeout=null;constructor(){this.svg=document.getElementById("rings"),this.phaseLabel=document.getElementById("phase-label"),this.timeRemaining=document.getElementById("time-remaining"),this.transitionPrompt=document.getElementById("transition-prompt"),this.dayPosition=document.getElementById("day-position"),this.statusBar=document.getElementById("status-bar"),this.guidanceEl=document.getElementById("guidance"),this.rings=new Map,this.buildClock()}buildClock(){this.svg.innerHTML="";const t=T("defs",{});t.innerHTML=`
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="2.5" result="blur"/>
                <feComposite in="SourceGraphic" in2="blur" operator="over"/>
            </filter>
        `,this.svg.appendChild(t);const n={sprint:["24m","48m","72m"],day:["Dawn","Morning","Afternoon","Evening"]};for(const s of Oe){const o=T("g",{class:`ring-group ring-${s.id}`}),i=T("circle",{cx:String(w),cy:String(w),r:String(s.radius),fill:"none",stroke:s.color,"stroke-width":String(s.strokeWidth),opacity:"0.06",class:"ring-track"}),a=[];for(let f=0;f<4;f++){const g=T("path",{fill:"none",stroke:s.color,"stroke-width":String(s.strokeWidth),"stroke-linecap":"butt",opacity:"0",d:"",class:`ring-quarter ring-quarter-${f}`});g.style.filter="url(#glow)",a.push({path:g}),o.appendChild(g)}const c=-60*Math.PI/180,l=w+s.radius*Math.sin(c),d=w-s.radius*Math.cos(c),u=T("text",{x:String(l),y:String(d),fill:s.color,"font-size":String(Math.max(s.strokeWidth*.55,6)),"font-family":"'DM Sans', sans-serif","font-weight":"500","letter-spacing":"0.08em","text-anchor":"middle","dominant-baseline":"central",opacity:"0.5",class:"ring-label"});u.textContent=s.label.toUpperCase();const m=[],y=n[s.id];if(y){const f=s.id==="day",g=y.length;for(let p=0;p<g;p++){let E;f?E=p*90:E=(p+1)*90;const b=(E-90)*Math.PI/180,C=s.radius+s.strokeWidth/2+8,O=w+C*Math.cos(b),W=w+C*Math.sin(b),q=T("text",{x:String(O),y:String(W),fill:s.color,"font-size":"5.5","font-family":"'DM Sans', sans-serif","font-weight":"400","text-anchor":"middle","dominant-baseline":"central",opacity:"0.3",class:"ring-time-marker"});q.textContent=y[p],m.push(q),o.appendChild(q)}}o.appendChild(i),o.appendChild(u),this.rings.set(s.id,{group:o,track:i,quarters:a,label:u,timeMarkers:m,config:s}),this.svg.appendChild(o)}}update(t,n,s,o=0){const i=ne(t),a=i.dominant.color;document.documentElement.style.setProperty("--harmonic-color",a);const c=i.coherenceLevel==="strong"?1:i.coherenceLevel==="moderate"?.6:.35;document.documentElement.style.setProperty("--harmonic-glow",String(c));const l=t.sprint.active,d=l?.5:1;this.updateRing("sprint",t.sprint.progress,l),this.updateRing("day",t.day.progress,!0,l?d:1),this.updateRing("week",t.week.progress,n,l?d:1),this.updateRing("month",t.moon.progress,n,l?d:1),this.updateRing("year",t.year.personalProgress,n,l?d:1);const u=this.rings.get("sprint");if(u){const p=l?24:u.config.strokeWidth;u.track.setAttribute("stroke-width",String(p));for(const E of u.quarters)E.path.setAttribute("stroke-width",String(p))}if(l){const p=Ne(t.sprint.pulse.pulseNumber);this.phaseLabel.textContent=`${p} Â· ${Be(t.sprint.pulse.phaseRemaining)}`,this.timeRemaining.textContent="",this.phaseLabel.style.color="#e07040",this.dayPosition.textContent=`96-min sprint ${o+1}`,this.dayPosition.style.display="",this.guidanceEl.style.display="none"}else this.phaseLabel.textContent="",this.timeRemaining.textContent="",this.dayPosition.style.display="none",this.guidanceEl.style.display="";if(s&&l){const p=`${t.sprint.pulse.pulseNumber}-${t.sprint.pulse.phase}`;p!==this.lastPromptPhase&&(this.lastPromptPhase=p,this.showTransitionPrompt(t.sprint.pulse.phase,t.sprint.pulse.pulseNumber))}const m=new Date,y=`${String(m.getHours()).padStart(2,"0")}:${String(m.getMinutes()).padStart(2,"0")}`,f=t.week.planetaryDay.energy,g=t.moon.symbol;this.statusBar.innerHTML=`
            <span class="status-time">${y}</span>
            <span>${t.week.planetaryDay.emoji} ${f}</span>
            <span>${g} ${t.moon.phase}</span>
        `,this.updateSummaryPanel(t)}buildProgressBar(t,n=12){const s=Math.round(t*n);let o="";for(let i=0;i<n;i++)o+=i<s?"â–°":"â–±";return o}getElementEmoji(t){switch(t){case"will":return"ğŸ”¥";case"emanation":return"ğŸ’§";case"digestion":return"ğŸŒ";case"enrichment":return"ğŸŒ¬ï¸";default:return""}}getElementLabel(t){switch(t){case"will":return"Fire";case"emanation":return"Water";case"digestion":return"Earth";case"enrichment":return"Air";default:return""}}updateSummaryPanel(t){const n=document.getElementById("cycle-day");if(n){const i=n.querySelector(".cycle-bar"),a=n.querySelector(".cycle-phase");i.textContent=this.buildProgressBar(t.day.progress);const c=this.getElementEmoji(t.day.holonicPhase.id),l=this.getElementLabel(t.day.holonicPhase.id);a.textContent=`${c} ${t.day.holonicPhase.label} Â· ${l}`}const s=document.getElementById("cycle-week");if(s){const i=s.querySelector(".cycle-bar"),a=s.querySelector(".cycle-phase");i.textContent=this.buildProgressBar(t.week.progress);const c=this.getElementEmoji(t.week.holonicPhase.id),l=this.getElementLabel(t.week.holonicPhase.id);a.textContent=`${c} ${t.week.holonicPhase.label} Â· ${l}`}const o=document.getElementById("cycle-moon");if(o){const i=o.querySelector(".cycle-bar"),a=o.querySelector(".cycle-phase");i.textContent=this.buildProgressBar(t.moon.progress);const c=this.getElementEmoji(t.moon.holonicPhase.id),l=this.getElementLabel(t.moon.holonicPhase.id);a.textContent=`${c} ${t.moon.holonicPhase.label} Â· ${l}`}}updateRing(t,n,s,o=1){const i=this.rings.get(t);if(!i)return;const a=s?o:0;if(i.group.style.opacity=String(a),i.group.style.transition="opacity 0.8s ease",!s)return;const c=i.config.radius,d=360/4,u=1.5;for(let m=0;m<4;m++){const y=m*d,f=_e[m],g=i.quarters[m],p=m/4,E=(m+1)/4;let b;if(n>=E?b=1:n<=p?b=0:b=(n-p)/(E-p),b<=0){g.path.setAttribute("d",""),g.path.setAttribute("opacity","0");continue}const C=y+(m>0?u/2:0),O=y+b*d-(m<3&&b>=1?u/2:0);if(O<=C){g.path.setAttribute("d",""),g.path.setAttribute("opacity","0");continue}const W=$e(w,w,c,C,O);g.path.setAttribute("d",W),g.path.setAttribute("opacity",String(f)),g.path.setAttribute("stroke",i.config.color)}i.track.setAttribute("stroke",i.config.color),i.track.setAttribute("opacity","0.06"),i.label.setAttribute("fill",i.config.color),i.label.setAttribute("opacity","0.5")}showTransitionPrompt(t,n){const o={entry:["What is the one thing?","Settle in. Breathe.","Where does your attention want to go?","Arrive fully."],focus:[""],exit:["What emerged?","Breathe. Let it settle.","What wants to be carried forward?","Release. Integrate."]}[t],i=o[Math.min(n-1,o.length-1)];if(!i){this.transitionPrompt.classList.remove("visible");return}this.transitionPrompt.textContent=i,this.transitionPrompt.classList.remove("fading"),this.transitionPrompt.classList.add("visible"),this.promptTimeout&&clearTimeout(this.promptTimeout),this.promptTimeout=window.setTimeout(()=>{this.transitionPrompt.classList.add("fading"),this.transitionPrompt.classList.remove("visible")},15e3)}}function je(e,t){const n=new Date,s=n.getHours()*60+n.getMinutes(),[o,i]=e.split(":").map(Number),[a,c]=t.split(":").map(Number),l=o*60+i,d=a*60+c;return d>l?s>=l&&s<d:s>=l||s<d}const Ge={will:{strong:["All cycles point to planning. {planet} amplifies your clarity","Strong alignment: gather your intention before acting","The field is unified. Define your target with precision"],moderate:["{planet}. A good time to plan, but stay flexible","Most rhythms favour clarity. Set direction loosely","Planning energy is present. {moon}"],mixed:["{planet}. Some cycles say plan, others push to build. Trust what feels right","Mixed signals. Do a light planning pass, do not overcommit yet","Energy wants to scatter. Anchor in one intention"]},emanation:{strong:["Every rhythm says: build. {planet} is fuel for creation","Deep alignment for execution. This is rare. Use it.","All systems go. Create without hesitation"],moderate:["{planet}. Build energy is available, channel it","Creation window open. Focus on your most important craft","Good conditions for deep work. {moon}"],mixed:["{planet}. Some cycles resist building. Work in short focused bursts","Build what you can, but do not force. The field is uneven","Partial build energy. Alternate between creating and reflecting"]},digestion:{strong:["Every cycle says share. {planet} carries your voice further","Strong communication alignment. Ship. Publish. Connect.","The field amplifies anything you put out right now"],moderate:["{planet}. Communication energy is present, share what is ready","Good time to polish and ship. {moon}","Moderate sharing energy. Send the message, make the call"],mixed:["{planet}. Mixed signals. Communicate selectively, not everything","Some cycles favour sharing, others rest. Lead with the refined","Share only what is truly ready. Let the rest marinate."]},enrichment:{strong:["All cycles say integrate. {planet} deepens the rest","Rare moment of full integration. Let everything settle.","The field asks for stillness. Trust it."],moderate:["{planet}. Integration energy is here, let things land","Do not push. Review, absorb, let insights arrive. {moon}","Good conditions for reflection and gentle integration"],mixed:["{planet}. The field is uneven. Integrate what you can, create when called","Partial rest energy. Do not force productivity, do not force rest","Some cycles pulse, others settle. Ride the wave"]}},We={entry:{1:"Breathe in. Set your intention for this sprint.",2:"New pulse. Arrive. What is the focus?",3:"Third pulse. Momentum is building. Land here.",4:"Final pulse. Make it count. Settle in."},focus:{1:"Deep work. Protect this time. Build the thing.",2:"Second pulse focus. You are warmed up. Stay with it.",3:"Third pulse. Peak energy. This is where breakthroughs happen.",4:"Last focus window. Pour what is left into it."},exit:{1:"Capture what emerged. Three more pulses ahead.",2:"Good work. Capture, breathe, transition.",3:"Almost there. One more pulse. Rest briefly.",4:"Sprint complete. Walk. Hydrate. Let it integrate."}};function qe(e){const t=new Date().getHours();return e[t%e.length]}function Fe(e,t){const n=t.week.planetaryDay.energy,s=t.moon.energy;return e.replace(/\{planet\}/g,n).replace(/\{moon\}/g,s)}function Ue(e,t="07:00",n="23:00"){if(!je(t,n))return{message:"Rest time. "+e.moon.energy.toLowerCase(),category:"rest"};if(e.sprint.active){const{phase:u,pulseNumber:m}=e.sprint.pulse;return{message:We[u]?.[m]||"Stay present. Breathe.",category:u==="focus"?"do":u==="entry"?"be":"rest"}}const s=ne(e),{dominant:o,coherenceLevel:i}=s,a=Ge[o.id]?.[i];if(!a)return{message:o.action,category:"be"};const c=qe(a);return{message:Fe(c,e),category:{will:"be",emanation:"do",digestion:"do",enrichment:"rest"}[o.id]||"be"}}const de={},oe="equilibrium-ai-insight",Ye=1800*1e3,Ke=1e4,re=de?.VITE_SUPABASE_URL||"",Ve=de?.VITE_SUPABASE_PUBLISHABLE_KEY||"";function ze(e,t){return`${e}|${t}`}const ae={will:{insight:"Planning energy present",activities:["strategizing","choosing priorities"]},emanation:{insight:"Build energy present",activities:["deep work","creating"]},digestion:{insight:"Communication energy present",activities:["sharing","conversations"]},enrichment:{insight:"Integration energy present",activities:["reflecting","reviewing"]}};function j(e){return ae[e]||ae.emanation}async function Je(e,t,n,s,o){const i=ze(e,n);try{const l=sessionStorage.getItem(oe);if(l){const d=JSON.parse(l);if(d.cacheKey===i&&Date.now()-d.timestamp<Ye)return d.data}}catch{}if(!re)return j(n);const a=new AbortController,c=setTimeout(()=>a.abort(),Ke);try{const l=await fetch(`${re}/functions/v1/generate-equilibrium-insight`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ve}`},body:JSON.stringify({dayEnergy:e,moonEnergy:t,dominantPhase:n,coherenceLevel:s,userIntention:o}),signal:a.signal});if(clearTimeout(c),!l.ok)return console.warn("AI insight fetch failed:",l.status),j(n);const d=await l.json();try{sessionStorage.setItem(oe,JSON.stringify({data:d,timestamp:Date.now(),cacheKey:i}))}catch{}return d}catch(l){return clearTimeout(c),console.warn("AI insight error:",l),j(n)}}const ue="equilibrium-state";function Qe(){const e={preferences:{breathDuration:11,transitionPrompts:!0,showOuterRings:!0,wakeTime:"07:00",sleepTime:"23:00",birthday:""},sprintStartTime:null,sprintLog:[],intentions:{sprint:null,day:null,week:null,moon:null}};try{const t=localStorage.getItem(ue);if(t){const n=JSON.parse(t),s={...e.preferences,...n.preferences||{}},o={...e.intentions,...n.intentions||{}};let i=n.sprintStartTime||null;return i&&(Date.now()-i)/6e4>=96&&(i=null),{preferences:s,sprintStartTime:i,sprintLog:n.sprintLog||[],intentions:o}}}catch(t){console.warn("Failed to load state, using defaults:",t)}return e}function h(e){try{localStorage.setItem(ue,JSON.stringify(e))}catch(t){console.warn("Failed to save state:",t)}}const r=Qe(),Xe=new He,me="equilibrium-theme",pe=document.getElementById("theme-toggle");function ge(e){document.documentElement.setAttribute("data-theme",e),pe.textContent=e==="dark"?"â˜½":"â˜€",localStorage.setItem(me,e)}const Ze=localStorage.getItem(me)||"dark";ge(Ze);pe.addEventListener("click",()=>{const e=document.documentElement.getAttribute("data-theme")||"dark";ge(e==="dark"?"light":"dark")});const M=document.getElementById("guidance"),A=document.getElementById("activities"),$=document.getElementById("sprint-cta");let I=null,F=!1,le="";async function et(e){const t=ne(e),n=e.week.planetaryDay.energy,s=e.moon.energy,o=t.dominant.id,i=t.coherenceLevel,a=r.intentions.sprint?.text||r.intentions.day?.text||r.intentions.week?.text||r.intentions.moon?.text||null,c=`${n}|${o}`;if(!(c===le&&I)&&!F){le=c,F=!0;try{I=await Je(n,s,o,i,a)}catch{I=j(o)}F=!1}}document.documentElement.style.setProperty("--breath-duration",`${r.preferences.breathDuration}s`);const he=document.getElementById("birthday-prompt"),tt=document.getElementById("birthday-input"),nt=document.getElementById("birthday-confirm");r.preferences.birthday||he.classList.remove("hidden");nt.addEventListener("click",()=>{const e=tt.value;e&&(r.preferences.birthday=e,h(r)),he.classList.add("hidden")});const it=document.getElementById("settings-toggle"),N=document.getElementById("settings-overlay"),st=document.getElementById("settings-close"),Y=document.getElementById("breath-duration"),ye=document.getElementById("breath-duration-label"),K=document.getElementById("toggle-prompts"),V=document.getElementById("toggle-outer-rings"),z=document.getElementById("wake-time"),J=document.getElementById("sleep-time"),Q=document.getElementById("birthday");Y.value=String(r.preferences.breathDuration);ye.textContent=`${r.preferences.breathDuration}s`;K.checked=r.preferences.transitionPrompts;V.checked=r.preferences.showOuterRings;z.value=r.preferences.wakeTime;J.value=r.preferences.sleepTime;Q.value=r.preferences.birthday;it.addEventListener("click",()=>{N.classList.remove("hidden")});st.addEventListener("click",()=>{N.classList.add("hidden")});N.addEventListener("click",e=>{e.target===N&&N.classList.add("hidden")});Y.addEventListener("input",()=>{const e=parseInt(Y.value);r.preferences.breathDuration=e,ye.textContent=`${e}s`,document.documentElement.style.setProperty("--breath-duration",`${e}s`),h(r)});K.addEventListener("change",()=>{r.preferences.transitionPrompts=K.checked,h(r)});V.addEventListener("change",()=>{r.preferences.showOuterRings=V.checked,h(r)});z.addEventListener("change",()=>{r.preferences.wakeTime=z.value,h(r)});J.addEventListener("change",()=>{r.preferences.sleepTime=J.value,h(r)});Q.addEventListener("change",()=>{r.preferences.birthday=Q.value,h(r)});const X=document.getElementById("intention-day"),Z=document.getElementById("intention-week"),ee=document.getElementById("intention-moon");X.value=r.intentions.day?.text||"";Z.value=r.intentions.week?.text||"";ee.value=r.intentions.moon?.text||"";X.addEventListener("change",()=>{const e=X.value.trim();r.intentions.day=e?{text:e,setAt:Date.now()}:null,h(r)});Z.addEventListener("change",()=>{const e=Z.value.trim();r.intentions.week=e?{text:e,setAt:Date.now()}:null,h(r)});ee.addEventListener("change",()=>{const e=ee.value.trim();r.intentions.moon=e?{text:e,setAt:Date.now()}:null,h(r)});const _=document.getElementById("sprint-entry"),k=document.getElementById("sprint-intention-input"),ot=document.getElementById("sprint-begin"),rt=document.getElementById("sprint-skip"),te=document.getElementById("phase-bar"),at=te.querySelectorAll(".phase-segment");function ie(e){r.sprintStartTime=Date.now(),e.trim()?r.intentions.sprint={text:e.trim(),setAt:Date.now()}:r.intentions.sprint=null,h(r),$.classList.add("hidden"),_.classList.add("hidden"),k.value=""}$.addEventListener("click",()=>{r.sprintStartTime||(_.classList.remove("hidden"),k.focus())});M.style.cursor="pointer";A.style.cursor="pointer";M.addEventListener("click",()=>{r.sprintStartTime||(_.classList.remove("hidden"),k.focus())});A.addEventListener("click",()=>{r.sprintStartTime||(_.classList.remove("hidden"),k.focus())});ot.addEventListener("click",()=>{ie(k.value)});rt.addEventListener("click",()=>{ie("")});k.addEventListener("keydown",e=>{e.key==="Enter"?ie(k.value):e.key==="Escape"&&_.classList.add("hidden")});let P=null;const G=document.getElementById("clock-container"),L=document.createElement("div");L.id="hold-feedback";L.textContent="Hold to exit sprint";G.appendChild(L);G.addEventListener("pointerdown",e=>{r.sprintStartTime&&e.target.id!=="settings-toggle"&&(L.classList.add("visible"),P=window.setTimeout(()=>{r.sprintStartTime=null,h(r),$.classList.remove("hidden"),L.classList.remove("visible")},3e3))});G.addEventListener("pointerup",()=>{P&&(clearTimeout(P),P=null),L.classList.remove("visible")});G.addEventListener("pointerleave",()=>{P&&(clearTimeout(P),P=null),L.classList.remove("visible")});function fe(){const e=Date.now();let t;if(r.preferences.birthday){const a=r.preferences.birthday.split("-");t=`${a[1]}-${a[2]}`}const n=xe(e,r.sprintStartTime,r.preferences.breathDuration,t);r.sprintStartTime&&!n.sprint.active&&(r.sprintLog.push({date:new Date().toISOString().split("T")[0],sprintNumber:r.sprintLog.filter(a=>a.date===new Date().toISOString().split("T")[0]).length+1,startTime:new Date(r.sprintStartTime).toTimeString().slice(0,5),endTime:new Date().toTimeString().slice(0,5),completed:!0}),r.sprintStartTime=null,r.intentions.sprint=null,h(r),$.classList.remove("hidden")),r.sprintStartTime&&$.classList.add("hidden");const s=new Date().toISOString().split("T")[0],o=r.sprintLog.filter(a=>a.date===s).length;if(Xe.update(n,r.preferences.showOuterRings,r.preferences.transitionPrompts,o),n.sprint.active){te.classList.remove("hidden");const a=n.sprint.pulse.pulseNumber,c=n.sprint.pulse.phase;at.forEach((l,d)=>{const u=d+1;l.classList.remove("active","completed"),u<a||u===a&&c==="exit"?l.classList.add("completed"):u===a&&l.classList.add("active")})}else te.classList.add("hidden");const i=Ue(n,r.preferences.wakeTime,r.preferences.sleepTime);if(n.sprint.active){if(A.style.display="none",r.intentions.sprint?.text){const a=Math.ceil(96-(Date.now()-r.sprintStartTime)/6e4);M.textContent=`"${r.intentions.sprint.text}" Â· ${a}m left`,M.style.display=""}}else{et(n);const a=r.intentions.sprint?.text||r.intentions.day?.text||r.intentions.week?.text||r.intentions.moon?.text||null;I?(M.textContent=a?`"${a}" Â· ${I.insight}`:I.insight,A.textContent=I.activities.join(" Â· "),A.style.display=""):(M.textContent=a?`"${a}"`:i.message,A.style.display="none")}requestAnimationFrame(fe)}fe();
